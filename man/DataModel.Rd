% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class_data_model.R
\docType{class}
\name{DataModel}
\alias{DataModel}
\title{SUSNEO data model}
\format{
An \link[R6:R6Class]{R6::R6Class} generator.
}
\description{
SUSNEO data model

SUSNEO data model
}
\details{
Core R6 class encapsulating canonicalization, validation, filtering,
KPI calculations, and the merge policy (Append + Override).
}
\section{Methods}{

\itemize{
\item \code{initialize()}, \code{set_filters()}, \code{filtered_data()}
\item \code{canonicalize()}, \code{validate()}, \code{merge()}
\item \code{status()}, KPI methods, \code{timeseries()}, \code{compare()}, \code{summary_table()}
}
}

\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{dataset}}{Current tibble of records.}

\item{\code{sources}}{Data frame of provenance rows (tag, time, appended, replaced, new_sites, new_types).}

\item{\code{filters}}{List with \code{date} (length-2 Date), \code{sites} (character), \code{types} (character).}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-DataModel-set_filters}{\code{DataModel$set_filters()}}
\item \href{#method-DataModel-filtered_data}{\code{DataModel$filtered_data()}}
\item \href{#method-DataModel-new}{\code{DataModel$new()}}
\item \href{#method-DataModel-canonicalize}{\code{DataModel$canonicalize()}}
\item \href{#method-DataModel-validate}{\code{DataModel$validate()}}
\item \href{#method-DataModel-merge}{\code{DataModel$merge()}}
\item \href{#method-DataModel-status}{\code{DataModel$status()}}
\item \href{#method-DataModel-reset}{\code{DataModel$reset()}}
\item \href{#method-DataModel-kpi_total_consumption}{\code{DataModel$kpi_total_consumption()}}
\item \href{#method-DataModel-kpi_total_emissions}{\code{DataModel$kpi_total_emissions()}}
\item \href{#method-DataModel-kpi_avg_daily_consumption}{\code{DataModel$kpi_avg_daily_consumption()}}
\item \href{#method-DataModel-kpi_energy_intensity}{\code{DataModel$kpi_energy_intensity()}}
\item \href{#method-DataModel-timeseries}{\code{DataModel$timeseries()}}
\item \href{#method-DataModel-compare}{\code{DataModel$compare()}}
\item \href{#method-DataModel-summary_table}{\code{DataModel$summary_table()}}
\item \href{#method-DataModel-clone}{\code{DataModel$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-set_filters"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-set_filters}{}}}
\subsection{Method \code{set_filters()}}{
Set active filters (date range, sites, types).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$set_filters(dates = NULL, sites = NULL, types = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{dates}}{length-2 Date vector (min, max) or NULL.}

\item{\code{sites}}{character vector of site codes or NULL.}

\item{\code{types}}{character vector of types or NULL.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-filtered_data"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-filtered_data}{}}}
\subsection{Method \code{filtered_data()}}{
Return data after applying active filters.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$filtered_data()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A data.frame/tibble of filtered rows.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-new"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-new}{}}}
\subsection{Method \code{new()}}{
Initialize model and load bundled sample dataset.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$new()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A new \code{DataModel} object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-canonicalize"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-canonicalize}{}}}
\subsection{Method \code{canonicalize()}}{
Canonicalize input data (names, whitespace, case, types, dates).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$canonicalize(df)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{df}}{A data.frame-like object to canonicalize.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Canonicalized data.frame with required columns.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-validate"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-validate}{}}}
\subsection{Method \code{validate()}}{
Validate a canonicalized dataset against the data contract.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$validate(df)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{df}}{A data.frame to validate (usually after \code{canonicalize()}).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
\code{TRUE} if valid; otherwise a list with element \code{errors} (character).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-merge"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-merge}{}}}
\subsection{Method \code{merge()}}{
Merge an upload per policy (Append + Override; keep last within upload).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$merge(df, source_tag = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{df}}{Canonicalized data.frame to merge.}

\item{\code{source_tag}}{Optional tag/label for provenance.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Named list: \code{appended}, \code{replaced}, \code{new_sites}, \code{new_types} (integers).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-status"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-status}{}}}
\subsection{Method \code{status()}}{
Summary of current dataset, filters, and provenance.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$status()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
List with counts, date range, sites/types, and last source/time.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-reset"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-reset}{}}}
\subsection{Method \code{reset()}}{
Reset dataset and filters (keeps sources unless clear_sources=TRUE).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$reset(clear_sources = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{clear_sources}}{logical; if TRUE also clears provenance history.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-kpi_total_consumption"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-kpi_total_consumption}{}}}
\subsection{Method \code{kpi_total_consumption()}}{
Total consumption under current filters.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$kpi_total_consumption()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Numeric scalar.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-kpi_total_emissions"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-kpi_total_emissions}{}}}
\subsection{Method \code{kpi_total_emissions()}}{
Total emissions under current filters.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$kpi_total_emissions()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Numeric scalar.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-kpi_avg_daily_consumption"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-kpi_avg_daily_consumption}{}}}
\subsection{Method \code{kpi_avg_daily_consumption()}}{
Average daily consumption over the filtered date range.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$kpi_avg_daily_consumption()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Numeric scalar.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-kpi_energy_intensity"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-kpi_energy_intensity}{}}}
\subsection{Method \code{kpi_energy_intensity()}}{
Energy intensity = total consumption / distinct site-days.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$kpi_energy_intensity()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Numeric scalar.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-timeseries"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-timeseries}{}}}
\subsection{Method \code{timeseries()}}{
Aggregated time series for plots.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$timeseries(by = c("day", "month"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{by}}{One of \code{"day"} or \code{"month"}.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Data.frame with columns \code{period}, \code{value}, \code{emissions}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-compare"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-compare}{}}}
\subsection{Method \code{compare()}}{
Aggregations for comparison chart.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$compare(by = c("site", "type"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{by}}{One of \code{"site"} or \code{"type"}.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Data.frame grouped by \code{by} with totals.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-summary_table"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-summary_table}{}}}
\subsection{Method \code{summary_table()}}{
Summary table backing the dashboard (respects filters).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$summary_table()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Data.frame of currently filtered rows.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DataModel-clone"></a>}}
\if{latex}{\out{\hypertarget{method-DataModel-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DataModel$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
